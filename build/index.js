/*!
 * 
 *   simple-express-framework v2.4.0-rc.0
 *   https://github.com/Lukasz-pluszczewski/simple-express
 *
 *   Copyright (c) Łukasz Pluszczewski and project contributors.
 *
 *   This source code is licensed under the MIT license found in the
 *   LICENSE file in the root directory of this source tree.
 *
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("body-parser"),require("cookie-parser"),require("cors"),require("debug"),require("express"),require("lodash")):"function"==typeof define&&define.amd?define(["body-parser","cookie-parser","cors","debug","express","lodash"],r):"object"==typeof exports?exports.SimpleExpress=r(require("body-parser"),require("cookie-parser"),require("cors"),require("debug"),require("express"),require("lodash")):e.SimpleExpress=r(e.BodyParser,e.CookieParser,e.Cors,e.Debug,e.Express,e._)}(this,(function(e,r,t,n,o,a){return(()=>{var u={539:r=>{"use strict";r.exports=e},791:e=>{"use strict";e.exports=r},308:e=>{"use strict";e.exports=t},540:e=>{"use strict";e.exports=n},686:e=>{"use strict";e.exports=o},460:e=>{"use strict";e.exports=a},562:()=>{}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var t=s[e]={exports:{}};return u[e](t,t.exports,i),t.exports}i.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return i.d(r,{a:r}),r},i.d=(e,r)=>{for(var t in r)i.o(r,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},i.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{"use strict";i.r(c),i.d(c,{ValidationError:()=>xe,checkPropTypes:()=>we,default:()=>Re,handleError:()=>ae,wrapMiddleware:()=>Ee});var e=i(562),r=i.n(e),t=i(686),n=i.n(t),o=i(308),a=i.n(o),u=i(539),s=i.n(u),l=i(791),p=i.n(l),f=i(460),d=i.n(f),y=i(540),m=i.n(y),h=m()("simpleExpress");h.request=m()("simpleExpress:request"),h.stats=m()("simpleExpress:stats"),h.warning=m()("simpleExpress:warning");const b=h;function v(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function g(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?v(Object(t),!0).forEach((function(r){w(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function w(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}const O=function(e){var r={counters:{},events:{}},t=function(e,t,n){r[e]||(r[e]={}),r[e][t]||(r[e][t]=[]),r[e][t].push(n)},n={set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return r.counters[e]=t},add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return r.counters[e]=r.counters[e]?r.counters[e]+t:t},getCounter:function(e){return r.counters[e]},registerEvent:function(e,r){switch(e){case"registeringRoute":n.add("routes"),n.add("routeHandlers",r.numberOfHandlers),t("events",e,g({timestamp:Date.now()},r));break;default:t("events",e,g({timestamp:Date.now()},r))}},getEvents:function(e){return r.events[e]},logStartup:function(){if(e?b.stats("--\x3eStats for simpleExpress app on ".concat(e," port:<--")):b.stats("--\x3eStats for simpleExpress app (no port):<--"),function(e){var r=[];e.getCounter("cors")&&r.push("cors"),e.getCounter("jsonBodyParser")&&r.push("bodyParser.json"),e.getCounter("cookieParser")&&r.push("cookie-parser"),r.length&&b.stats("  Used built-in middlewares: ".concat(r.join(", ")))}(n),n.getCounter("expressMiddleware")&&b.stats("  Registered ".concat(n.getCounter("expressMiddleware")," expressMiddleware").concat(n.getCounter("expressMiddleware")>1?"s":"")),n.getCounter("middleware")&&b.stats("  Registered ".concat(n.getCounter("middleware")," middleware").concat(n.getCounter("middleware")>1?"s":"")),n.getCounter("errorHandlers")&&b.stats("  Registered ".concat(n.getCounter("errorHandlers")," errorHandlers").concat(n.getCounter("errorHandlers")>1?"s":"")),!n.getCounter("routes"))return b.stats("  No routes registered");b.stats("  Registered ".concat(n.getCounter("routes")," routes with ").concat(n.getCounter("routeHandlers")," handlers:"));var t=new Set,o={};r.events.registeringRoute.forEach((function(e){var r=e.path,n=e.method,a=e.numberOfHandlers,u=e.names;o[r]||(o[r]=[]),o[r].push({method:n,numberOfHandlers:a,names:u}),t.add(r)})),t.forEach((function(e){var r=0!==e.indexOf("/")&&"*"!==e;b.stats("    ".concat(e).concat(r?' - WARNING: Route not starting with "/"!':"")),o[e].forEach((function(e){var r=e.method,t=e.numberOfHandlers,n=e.names,o=void 0===n?[]:n,a=!1;o.forEach((function(e){"anonymous"!==e&&(a=!0)})),b.stats("      ".concat(r).concat(t>1||a?", ".concat(t," handler").concat(1===t?"":"s"):"").concat(o&&o.length&&a?": ".concat(o.join(", ")):""))}))}))}};return n};var P=["path","handlers","routes"];function x(e){return function(e){if(Array.isArray(e))return e}(e)||R(e)||E(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function S(e){return function(e){if(Array.isArray(e))return A(e)}(e)||R(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,r){if(e){if("string"==typeof e)return A(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?A(e,r):void 0}}function R(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function A(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var k={mergeParams:!0},q=["use","get","post","put","delete","del","options","patch","head","checkout","copy","lock","merge","mkactivity","mkcol","move","m-search","notify","purge","report","search","subscribe","trace","unlock","unsubscribe"],C=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.map((function(e,t){return e?0===t&&t===r.length-1?e:0===t?d().trimEnd(e,"/"):t===r.length-1?d().trimStart(e,"/"):d().trim(e,"/"):""})).filter((function(e){return e}))},H=function(){return C.apply(void 0,arguments).join("/")},M=function(e){return function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var a=n[0],u=n.slice(1);return"string"==typeof a?e[r].apply(e,[a].concat(S(u))):e[r].apply(e,["/"].concat(n))}};const D=function(e){var r=e.stats,n=e.createHandlerWithParams,o=function(e){var r=e.stats,t={},n={registerRoute:function(e){var r=e.path,n=e.method,o=e.handler,a=C(r),u=n?function(e){return e.toLowerCase()}(n):"use (middleware)";d().set(t,[].concat(S(a),[n,"path"]),r),d().set(t,[].concat(S(a),[n,"method"]),u),d().set(t,[].concat(S(a),[n,"numberOfHandlers"]),d().get(t,[].concat(S(a),["numberOfHandlers"]),0)+1),d().set(t,[].concat(S(a),[n,"names"]),[].concat(S(d().get(t,[].concat(S(a),["names"]),[])),[o.name&&o.name!==n?o.name:"anonymous"])),d().set(t,[].concat(S(a),[n,"handlers"]),[].concat(S(d().get(t,[].concat(S(a),["handlers"]),[])),[o.toString()]))},logRoute:function(e){if(e.path)return r.registerEvent("registeringRoute",{path:H.apply(void 0,S(e.path)),method:e.method,numberOfHandlers:e.numberOfHandlers,names:e.names});d().forEach(e,n.logRoute)},logRoutes:function(){n.logRoute(t)},getRoutes:function(){return t}};return n}({stats:r}),a=function e(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=a.subPath,s=void 0===u?[]:u,i=a.method;if(d().isFunction(r))return o.registerRoute({path:s,method:i,handler:r}),n(r);var c=(0,t.Router)(k);if(d().isPlainObject(r)){var l=r.path,p=r.handlers,f=r.routes,y=j(r,P);l?(p||f||M(c)("use",l,e(y,{subPath:[].concat(S(s),[l]),method:i})),p&&M(c)("use",l,e(p,{subPath:[].concat(S(s),[l]),method:i})),f&&M(c)("use",l,e(f,{subPath:[].concat(S(s),[l]),method:i}))):d().forEach(r,(function(r,t){q.includes(t)?M(c)(t,e(r,{subPath:s,method:t})):M(c)("use",t,e(r,{subPath:[].concat(S(s),[t]),method:i}))}))}if(Array.isArray(r)){var m=x(r),h=m[0],b=m.slice(1);"string"==typeof h?M(c)("use",h,e(b,{subPath:[].concat(S(s),[h]),method:i})):r.forEach((function(r){M(c)("use",e(r,{subPath:s,method:i}))}))}return c};return function(e){var r=a(e);return o.logRoutes(),r}};var U={default:"send",json:"json",send:"send",none:null};const I=function(e,r){return e&&U.hasOwnProperty(e)?U[e]:U.default};const T=function(e,r,t){if(t){if(r.headersSent)return b("ERROR: Headers have already been sent");var n=t.body,o=void 0===n?null:n,a=t.status,u=t.method,s=t.redirect,i=void 0!==s&&s,c=t.headers,l=void 0===c?null:c,p=t.type,f=void 0===p?null:p,d=I(u,o);d&&(f&&r.type(f),l&&r.set(l),i?(a?r.redirect(a,i):r.redirect(i),b.request("Request ended with redirect after ".concat(Date.now()-e.requestTiming,"ms; ").concat(e.protocol,", ").concat(e.originalUrl).concat(a&&", status: ".concat(a)))):(b.request("Request ended with response after ".concat(Date.now()-e.requestTiming,"ms; ").concat(e.protocol,", ").concat(e.originalUrl,", status: ").concat(a||200)),r.status(a||200)[d](o)))}};function _(e,r,t,n,o,a,u){try{var s=e[a](u),i=s.value}catch(e){return void t(e)}s.done?r(i):Promise.resolve(i).then(n,o)}function B(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function u(e){_(a,n,o,u,s,"next",e)}function s(e){_(a,n,o,u,s,"throw",e)}u(void 0)}))}}var F=function(){var e=B(regeneratorRuntime.mark((function e(r,t,n){var o,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=[],a=n,e.t0=regeneratorRuntime.keys(r);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(u=e.t1.value,!r.hasOwnProperty(u)){e.next=10;break}return e.next=8,t(r[u],u,a);case 8:a=e.sent,o.push(a);case 10:e.next=3;break;case 12:return e.abrupt("return",{lastResult:a,results:o});case 13:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}();function N(e,r,t,n,o,a,u){try{var s=e[a](u),i=s.value}catch(e){return void t(e)}s.done?r(i):Promise.resolve(i).then(n,o)}function $(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function u(e){N(a,n,o,u,s,"next",e)}function s(e){N(a,n,o,u,s,"throw",e)}u(void 0)}))}}var V=function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!1};return function(){var n=$(regeneratorRuntime.mark((function n(o){var a,u,s,i,c,l=arguments;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:for(a=l.length,u=new Array(a>1?a-1:0),s=1;s<a;s++)u[s-1]=l[s];return n.next=3,F(e,(function(e,n,o){return e[r]&&!t(o)?e[r].apply(e,[o].concat(u)):o}),o);case 3:return i=n.sent,c=i.lastResult,n.abrupt("return",c);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()};function W(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function z(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?W(Object(t),!0).forEach((function(r){G(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):W(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function G(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function L(e,r,t,n,o,a,u){try{var s=e[a](u),i=s.value}catch(e){return void t(e)}s.done?r(i):Promise.resolve(i).then(n,o)}function J(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function u(e){L(a,n,o,u,s,"next",e)}function s(e){L(a,n,o,u,s,"throw",e)}u(void 0)}))}}var K=function(e,r){var t=e.additionalParams,n=void 0===t?{}:t,o=e.plugins;return function(e){return function(){var t=J(regeneratorRuntime.mark((function t(a,u,s){var i,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.requestTiming||(a.requestTiming=Date.now(),b.request("Request started ".concat(a.requestTiming,"ms, ").concat(a.protocol,", ").concat(a.originalUrl))),t.next=3,V(o,"getHandlerParams")(z(z({body:a.body,query:a.query,params:a.params,method:a.method,originalUrl:a.originalUrl,protocol:a.protocol,xhr:a.xhr,get:function(e){return a.get(e)},getHeader:function(e){return a.get(e)},locals:u.locals,next:s,req:a,res:u},n),{},{simpleExpress:r}));case 3:return c=t.sent,t.prev=4,t.next=7,e(c);case 7:i=t.sent,t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(4),t.abrupt("return",s(t.t0));case 13:if(!(i instanceof Error)){t.next=15;break}return t.abrupt("return",s(i));case 15:return t.next=17,V(o,"mapResponse",(function(e){return!e||"none"===e.type}))(i,c);case 17:l=t.sent,T(a,u,l);case 19:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(e,r,n){return t.apply(this,arguments)}}()}},Q=function(e,r){var t=e.additionalParams,n=void 0===t?{}:t,o=e.plugins;return function(e){return function(){var t=J(regeneratorRuntime.mark((function t(a,u,s,i){var c,l,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,V(o,"getErrorHandlerParams")(z(z({body:u.body,query:u.query,method:u.method,originalUrl:u.originalUrl,protocol:u.protocol,xhr:u.xhr,get:u.get,getHeader:function(e){return u.get(e)},locals:s.locals,next:i,req:u,res:s},n),{},{simpleExpress:r}));case 2:return l=t.sent,t.prev=3,t.next=6,e(a,l);case 6:c=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return",i(t.t0));case 12:if(!(c instanceof Error)){t.next=14;break}return t.abrupt("return",i(c));case 14:return t.next=16,V(o,"mapResponse",(function(e){return!e||"none"===e.type}))(c,l);case 16:p=t.sent,T(u,s,p);case 18:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e,r,n,o){return t.apply(this,arguments)}}()}};Function.call.bind(Object.prototype.hasOwnProperty);const X=function(e,r,t,n,o){return[]};function Y(e){return function(e){if(Array.isArray(e))return Z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return Z(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Z(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ee(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==t)return;var n,o,a=[],u=!0,s=!1;try{for(t=t.call(e);!(u=(n=t.next()).done)&&(a.push(n.value),!r||a.length!==r);u=!0);}catch(e){s=!0,o=e}finally{try{u||null==t.return||t.return()}finally{if(s)throw o}}return a}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return re(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return re(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function re(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ne=function(e){return 1===e.length&&Array.isArray(e[0])?e[0].reduce((function(e,r){return Array.isArray(r)?1===r.length?e.push([null,r[0]]):Array.isArray(r[0])?r[0].forEach((function(t){e.push([t,r[1]])})):e.push(r):e.push([null,r]),e}),[]):1===e.length?[[null,e[0]]]:Array.isArray(e[0])?e[0].map((function(r){return[r,e[1]]})):[e]},oe=function(e){var r=ee(e,2),t=r[0],n=r[1];return function(e){if(e&&!d().isFunction(e))throw new Error("handleError arguments error: expected constructor (e.g. Error class) but got ".concat(te(e)))}(t),function(e){if(!d().isFunction(e))throw new Error("handleError arguments error: expected error handler function but got ".concat(te(e)))}(n),function(e,r){return!t||e instanceof t?n(e,r):e}};const ae=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=ne(r);return n.map(oe)};function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function se(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"==typeof e)return ie(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ie(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ce(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function le(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ce(Object(t),!0).forEach((function(r){pe(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ce(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function pe(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function fe(e,r,t,n,o,a,u){try{var s=e[a](u),i=s.value}catch(e){return void t(e)}s.done?r(i):Promise.resolve(i).then(n,o)}function de(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function u(e){fe(a,n,o,u,s,"next",e)}function s(e){fe(a,n,o,u,s,"throw",e)}u(void 0)}))}}function ye(e,r){return!r||"object"!==ue(r)&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function me(e){var r="function"==typeof Map?new Map:void 0;return(me=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,n)}function n(){return he(e,arguments,ge(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ve(n,e)})(e)}function he(e,r,t){return(he=be()?Reflect.construct:function(e,r,t){var n=[null];n.push.apply(n,r);var o=new(Function.bind.apply(e,n));return t&&ve(o,t.prototype),o}).apply(null,arguments)}function be(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function ve(e,r){return(ve=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var we=function(e){return function(r){var t=r.req,n=(r.res,r.next),o=t.method,a=t.originalUrl,u=[];e.body&&(u=[].concat(Y(u),Y(X({body:e.body},{body:t.body},"value","".concat(o.toUpperCase()," ").concat(a))))),e.query&&(u=[].concat(Y(u),Y(X(e.query,t.query,"query value","".concat(o.toUpperCase()," ").concat(a))))),e.params&&(u=[].concat(Y(u),Y(X(e.params,t.params,"param","".concat(o.toUpperCase()," ").concat(a))))),e.cookies&&(u=[].concat(Y(u),Y(X(e.cookies,t.cookies,"cookie","".concat(o.toUpperCase()," ").concat(a))))),e.headers&&(u=[].concat(Y(u),Y(X(e.headers,t.headers,"header","".concat(o.toUpperCase()," ").concat(a))))),u.length&&n(new xe(u)),n()}},Oe=Symbol("defaultAppValue"),Pe=Symbol("defaultServerValue"),xe=function(e){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&ve(e,r)}(o,e);var r,t,n=(r=o,t=be(),function(){var e,n=ge(r);if(t){var o=ge(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return ye(this,e)});function o(e){var r;return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this)).errors=e,r}return o}(me(Error)),je=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{cors:null,jsonBodyParser:null,cookieParser:[]};if(!e)return r;var t=e.cors,n=void 0===t?r.cors:t,o=e.jsonBodyParser,a=void 0===o?r.jsonBodyParser:o,u=e.cookieParser,s=void 0===u?r.cookieParser:u;return{cors:n,jsonBodyParser:a,cookieParser:s}},Se=function(e){var r,t=e.routes,n=e.routeParams;return{runRoute:(r=de(regeneratorRuntime.mark((function e(r,o,a){var u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=3;break}return b.warning('Only "array of objects" style routes are supported by runRoute helper'),e.abrupt("return",Promise.reject());case 3:if(u=d().find(t,(function(e){if(Array.isArray(e))return b.warning('Only "array of objects" style routes are supported by runRoute helper'),Promise.reject()}))){e.next=6;break}return e.abrupt("return",Promise.reject());case 6:if(s=d().get(u,["handler",o])){e.next=9;break}return e.abrupt("return",Promise.reject());case 9:return e.abrupt("return",s(le(le({},n),a)));case 10:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)}),getRoutes:function(){return t}}},Ee=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return d().flattenDeep(r).map((function(e){return function(r){var t=r.req,n=r.res,o=r.next;e(t,n,o)}}))};const Re=function(){var e=de(regeneratorRuntime.mark((function e(){var t,o,u,i,c,l,f,y,m,h,v,g,w,P,x,j,S,E,R,A,k,q,C,H,M,U,I,T,_,B,F,N,$,V,W,z=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=z.length>0&&void 0!==z[0]?z[0]:{},o=t.port,u=t.plugins,i=void 0===u?[]:u,c=t.routes,l=void 0===c?[]:c,f=t.middleware,y=void 0===f?[]:f,m=t.middlewares,h=t.simpleExpressMiddlewares,v=t.globalMiddlewares,g=t.errorHandlers,w=void 0===g?[]:g,P=t.expressMiddlewares,x=t.expressMiddleware,j=void 0===x?[]:x,S=t.config,E=t.routeParams,R=void 0===E?{}:E,A=t.app,k=void 0===A?Oe:A,q=t.server,C=void 0===q?Pe:q,b(o?"Initializing simpleExpress app on port ".concat(o,"..."):"Initializing simpleExpress app (no port)..."),v&&(b.warning('"globalMiddlewares" option is deprecated. Use "middleware" option.'),y=[].concat(se(y),se(v))),h&&(b.warning('"simpleExpressMiddlewares" option is deprecated. Use "middleware" option.'),y=[].concat(se(y),se(h))),m&&(b.warning('"middlewares" option is deprecated. Use "middleware" (without "s") option.'),y=[].concat(se(y),se(m))),P&&(b.warning('"expressMiddlewares" option is deprecated. Use "expressMiddleware" (without "s") option.'),j=[].concat(se(j),se(P))),H={port:o,plugins:i,routes:l,middleware:y,errorHandlers:w,expressMiddleware:j,config:S,routeParams:R,app:k,server:C},M=i.map((function(e){return e(H)})),U=O(o),I=k===Oe?n()():k,T=C===Pe?r().createServer(I):C,I.server=T,e.next=14,Se({routes:l,routeParams:R});case 14:if(_=e.sent,!1!==(B=je(S)).cors&&(U.set("cors"),I.use(a()(B.cors))),!1!==B.jsonBodyParser&&(U.set("jsonBodyParser"),I.use(s().json(B.jsonBodyParser))),!1!==B.cookieParser&&(U.set("cookieParser"),I.use(p()(B.cookieParser))),F=K({additionalParams:R,plugins:M},_),N=Q({additionalParams:R,plugins:M},_),$=d().flattenDeep(j),U.set("expressMiddleware",$.length),$.forEach((function(e){return I.use(e)})),V=d().flattenDeep(y),U.set("middleware",V.length),V.forEach((function(e){I.use(F(e))})),I.use(D({app:I,stats:U,createHandlerWithParams:F})(l)),W=d().flattenDeep(w),U.set("errorHandlers",W.length),W.forEach((function(e){I.use(N(e))})),o&&I.server.listen(o),!o||I.server.address()){e.next=35;break}throw b("ERROR: App started but app.server.address() is undefined. It seems that the ".concat(o," port is already used.")),new Error("App started but it doesn't seem to listen on any port. Check if port ".concat(o," is not already used."));case 35:return U.logStartup(),b(o?"App is listening on port ".concat(o):"App started. Not listening on any port."),e.abrupt("return",{app:I,server:T,stats:U});case 38:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()})(),c})()}));
//# sourceMappingURL=index.js.map